
| ≪ [ 05 함수와 모듈 ](/길벗/2024/818-파이썬_업무자동화/1부-파이썬_기초/05_함수와_모듈) | 06 크롤링 맛보기 | [ 07 크롤링에 익숙해지기 ](/길벗/2024/818-파이썬_업무자동화/2부-파이썬_크롤링/07_크롤링에_익숙해지기) ≫ |
|:----:|:----:|:----:|

# 61 음원 차트 수집하기

## 크롤링 crawling = 웹에서 데이터를 수집하는 기술

> "이번에 우리회사 가수 앨범이 나오니,
> 음원 사이트 톱 100 차트를 한시간마다 엑셀에 정리해줘"

## 611. 크롤링 관련 모듈 설치하기

- `bs4` 0.0.1, `requests` 2.31.0: 음원 차트 정보 수집
- `openpyxl` 3.1.2: 엑셀 관련 모듈
- `pillow` 10.1.0: 이미지처리 관련 모듈

## 612. 크롤링 프로그램 실행하기

### https://github.com/gilbutITbook/080363 소스코드 저장소

cc-커리어_스킬업_파이썬_업무_자동화_예제소스코드/080363/source/ch06-멜론차트수집.py
```
import requests
import urllib.request as req
from bs4 import BeautifulSoup
import os
import openpyxl
import datetime
from openpyxl.drawing.image import Image
from openpyxl.styles import Font, Alignment, PatternFill, Color, Border, Side

# 기존 엑셀 파일 삭제
if os.path.exists("./멜론_크롤링.xlsx"):
    os.remove("./멜론_크롤링.xlsx")

code = requests.get("https://www.melon.com/chart/index.htm", headers={"User-Agent":"Mozilla/5.0"})
soup = BeautifulSoup(code.text, "html.parser")
title = soup.select("div.ellipsis.rank01 > span > a")
name = soup.select("div.ellipsis.rank02 > span")
album = soup.select("div.ellipsis.rank03 > a")
img = soup.select("a.image_typeAll > img")

# 이미지 저장할 폴더 생성
if not os.path.exists("./멜론이미지"):
    os.mkdir("./멜론이미지")

# 엑셀 파일 생성
if not os.path.exists("./멜론_크롤링.xlsx"):
    openpyxl.Workbook().save("./멜론_크롤링.xlsx")

# 엑셀 파일 불러오기
book = openpyxl.load_workbook("./멜론_크롤링.xlsx")

# 쓸데 없는 시트 지우기
if "Sheet" in book.sheetnames:
    book.remove(book["Sheet"])
sheet = book.create_sheet()
now = datetime.datetime.now()
sheet.title = f"{now.year}년 {now.month}월 {now.day}일 {now.hour}시 {now.minute}분 {now.second}초"

# 열 너비 조절
sheet.cell(row=1, column=1).value = "앨범 이미지"
sheet.cell(row=1, column=2).value = "곡 이름"
sheet.cell(row=1, column=3).value = "가수 이름"
sheet.cell(row=1, column=4).value = "앨범 이름"
sheet.column_dimensions["A"].width = 15
sheet.column_dimensions["B"].width = 50
sheet.column_dimensions["C"].width = 30
sheet.column_dimensions["D"].width = 50

for i in range(len(title)):
    img_file_name = f"./멜론이미지/{i+1}.png"
    req.urlretrieve(img[i].attrs["src"], img_file_name)
    print(f"{i+1}위. {title[i].text} - {name[i].text}")
    img_for_excel = Image(img_file_name)
    sheet.add_image(img_for_excel, f"A{i+2}")
    sheet.cell(row=i + 2, column=2).value = title[i].text
    sheet.cell(row=i + 2, column=3).value = name[i].text
    sheet.cell(row=i + 2, column=4).value = album[i].text
    sheet.row_dimensions[i+2].height = 90

# 폰트
bold_font = Font(size=12, bold=True)
font = Font(size=12)

# 가운데 정렬
alignment_center = Alignment(horizontal="center", vertical="center")

# 셀 배경색
color_green = PatternFill(patternType="solid", fgColor=Color("4FC142"))

# 테두리
border = Border(left=Side(style="thin"), right=Side(style="thin"), top=Side(style="thin"), bottom=Side(style="thin"))

# 첫 행에 서식 지정
for row in sheet["A1:D1"]:
    for cell in row:
        cell.font = bold_font
        cell.alignment = alignment_center
        cell.fill = color_green
        cell.border = border

# 데이터 부분에 서식 지정
for row in sheet["A2:D101"]:
    for cell in row:
        cell.font = font
        cell.alignment = alignment_center
        cell.border = border

book.save("./멜론_크롤링.xlsx")
```

# 62 무비 차트 수집하기

## 621. 크롬 브라우저 설치하기

1. 크롬 공식 사이트 https://www.google.com/intl/ko/chrome 에서 [Chrome 다운로드] 클릭
받은 파일 ChromeSetup.exe 더블클릭해서 설치한다
1. 크롬 브라우저 실행후 오른쪽 위 점3개 아이콘 클릭후
나온 메뉴에서 [설정] 선택하고, [기본 브라우저] 클릭
1. 설정 > [기본으로 설정] 클릭
1. `기본 앱` 화면이 뜨면, Google Chrome  `>` 클릭후
[기본값 설정] 클릭해서 크롬을 기본 앱 브로우저로 설정한다.

## 622. 웹 페이지의 동작 원리

크롤링 프로그램 작성 전에 알아야 할것: 웹 페이지 동작 원리

1. 크롬 브라우저 주소창에 www.cgv.co.kr 입력해서 접속
1. 상단 [영화] 메뉴의 [무비차트] 클릭후
무비차트 페이지의 화면 빈 곳에서 마우스 오른쪽 버튼 클릭후 [검사] 클릭
1. 웹 브라우저 오른쪽에 `개발자 도구 DevTools` 화면
1. `[Elements]` 탭에 CGV 웹 개발자가 작성한 HTML 코드가 표시된다

### 클라이언트 와 서버 의 동작 원리

- 클라이언트 client: 서버에 접속할때 사용자가 사용하는 컴퓨터 또는 프로그램
- 서버 server: 클라이언트의 요청을 받아 응답하는 컴퓨터 또는 프로그램

서버가 보낸 HTML 을, 클라이언트가 받아서 실제 웹 사이트 모습으로 보여주는것 == 렌더링 rendering

## 623. 무비 차트 수집 프로그램 만들기

1. 프로젝트 폴더에 `ch06-CGV무비차트수집.py` 파일을 만든다

### 서버로부터 HTML 코드 받아오기

1. requests 와 bs4 모듈 불러오기
bs4 모듈에서는 BeautifulSoup 만 쓰므로 from ~ import 문을 사용해 불러온다.


| ≪ [ 05 함수와 모듈 ](/길벗/2024/818-파이썬_업무자동화/1부-파이썬_기초/05_함수와_모듈) | 06 크롤링 맛보기 | [ 07 크롤링에 익숙해지기 ](/길벗/2024/818-파이썬_업무자동화/2부-파이썬_크롤링/07_크롤링에_익숙해지기) ≫ |
|:----:|:----:|:----:|

> Page Properties:
> (1) Title: 06 크롤링 맛보기
> (2) Short Description: 파이썬 업무자동화
> (3) Path: / 길벗/2024/818-파이썬_업무자동화/2부-파이썬_크롤링/06_크롤링_맛보기
> Book Jemok: 커리어 스킬업 파이썬 업무자동화
> AuthorDate: 손원준 240620 492 pages
> Link: https://product.kyobobook.co.kr/detail/S000213585471
> create: 2024-08-18 일 17:07:42
> .md Name: 06_크롤링_맛보기.md

